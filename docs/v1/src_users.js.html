<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/users.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/users.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Users module.
 * @module Users
 */
const core = require( './core' );

const userHandler = {
	users: [],
	/**
	 * Add a new user
	 * @function addUser
	 * @param {int} uniqueID - unique id value
	 * @return {int} User unique id
	 */
	addUser: function( uniqueID ) {
		const newUser = {
			id: uniqueID,
			detectorHandler: new core.DetectorHandler(),
			expires: new Date( Date.now() + 5000 ),
			active: 300000
		};
		this.users.push( newUser );
		if ( this.users.length === 1 ) {
			enableUserExpirationInterval();
		}
		return newUser.id;
	},
	/**
	 * @function userExists
	 * @param {int} id
	 * @return {boolean} Does the user exist?
	 */
	userExists: function( id ) {
		const foundUser = this.users.find( ( user ) => user.id === id );
		const userCheck = typeof foundUser !== 'undefined';
		if ( userCheck ) {
			this.refreshUserSession( foundUser );
		}
		return userCheck;
	},
	/**
	 * @function getUser
	 * @param {int} id
	 * @return {Object|undefined} User object or undefined if the user doesn't exist.
	 */
	getUser: function( id ) {
		return this.users.find( ( user ) => user.id === id );
	},
	/**
	 * @function refreshUserSession
	 * @param {Object} user
	 */
	refreshUserSession: function( user ) {
		user.expires = new Date( Date.now() + user.active );
	},
	/**
	 * @function expirationTime
	 */
	expirationTime: function() {
		const len = this.users.length;
		this.users = this.users.filter( ( user ) => Date.now() &lt;= user.expires );
		if ( len !== this.users.length ) {
			console.log( len - this.users.length + ' users deleted' );
		}
	}
};

/**
 * @function enableUserExpirationInterval
 */
function enableUserExpirationInterval() {
	const expirationIntervalId = setInterval( function() {
		userHandler.expirationTime();
		if ( userHandler.users.length === 0 ) {
			console.log( 'no more users, interval stopped' );
			clearInterval( expirationIntervalId );
		}
	}, 1000 );
}


module.exports = userHandler;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-API.html">API</a></li><li><a href="module-Core.html">Core</a></li><li><a href="module-Detector.html">Detector</a></li><li><a href="module-Merge.html">Merge</a></li><li><a href="module-Operations.html">Operations</a></li><li><a href="module-Users.html">Users</a></li></ul><h3>Classes</h3><ul><li><a href="Detector.html">Detector</a></li><li><a href="DetectorHandler.html">DetectorHandler</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Oct 22 2019 21:38:13 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
